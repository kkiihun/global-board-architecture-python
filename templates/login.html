{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-5">
        <div class="card p-4">
            <h3 class="text-center mb-4">환영합니다!</h3>
            
            <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#login" type="button">로그인</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#signup" type="button">회원가입</button>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="login">
                    <form onsubmit="handleLogin(event)">
                        <div class="mb-3">
                            <label class="form-label">이메일</label>
                            <input type="email" id="loginEmail" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">비밀번호</label>
                            <input type="password" id="loginPw" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">로그인</button>
                    </form>
                </div>

                <div class="tab-pane fade" id="signup">
                    <form onsubmit="handleSignup(event)">
                        <div class="mb-3">
                            <label class="form-label">이메일</label>
                            <input type="email" id="signupEmail" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">비밀번호</label>
                            <input type="password" id="signupPw" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">가입하기</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 로그인 처리
    async function handleLogin(e) {
        e.preventDefault(); 
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPw').value;

        const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });

        if (res.ok) {
            window.location.href = "/";
        } else {
            alert("로그인 실패! 이메일과 비밀번호를 확인하세요.");
        }
    }

    // 회원가입 처리
    async function handleSignup(e) {
        e.preventDefault();
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPw').value;

        const res = await fetch('/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });

        if (res.ok) {
            alert("가입 성공! 로그인 탭에서 로그인 해주세요.");
            location.reload(); // 새로고침
        } else {
            const data = await res.json();
            alert("오류: " + data.detail);
        }
    }
</script>
{% endblock %}